<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="portabilis_biblioteca_comprovante_emprestimo" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" isFloatColumnFooter="true" uuid="11af0bee-27dd-4806-a18e-16a503914365">
	<property name="ireport.zoom" value="1.2100000000000013"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="instituicao" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new java.lang.Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="escola" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new java.lang.Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="cliente" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new java.lang.Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="dt_inicial" class="java.lang.String"/>
	<parameter name="dt_final" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT public.fcn_upper(instituicao.nm_instituicao) as nm_instituicao,
       exemplar_emprestimo.cod_emprestimo,
       exemplar_emprestimo.ref_cod_cliente,
       exemplar_emprestimo.ref_cod_exemplar,
       acervo.titulo as titulo,
       (select cadastro.pessoa.nome
          from cadastro.pessoa,
               cadastro.fisica,
               pmieducar.cliente
         where pessoa.idpes = fisica.idpes AND
               fisica.idpes = cliente.ref_idpes AND
               cliente.cod_cliente = exemplar_emprestimo.ref_cod_cliente) as cliente,

       (select fisica.cpf
          from cadastro.fisica,
               pmieducar.cliente
         where fisica.idpes = cliente.ref_idpes AND
               cliente.cod_cliente = exemplar_emprestimo.ref_cod_cliente) as cpf_cliente,

       to_char(data_retirada,'dd/mm/yyyy') as dt_retirada,
       to_char(data_devolucao,'dd/mm/yyyy') as dt_devolucao,
       exemplar_emprestimo.valor_multa,

       (SELECT biblioteca.nm_biblioteca
          FROM pmieducar.biblioteca
         WHERE acervo.ref_cod_biblioteca = biblioteca.cod_biblioteca) as nm_biblioteca,

      (SELECT COALESCE((SELECT COALESCE (fcn_upper(ps.nome),fcn_upper(juridica.fantasia))
          FROM cadastro.pessoa ps,
               cadastro.juridica
         WHERE escola.ref_idpes = juridica.idpes AND
               juridica.idpes = ps.idpes AND
	     ps.idpes = escola.ref_idpes),(SELECT nm_escola
                                               FROM pmieducar.escola_complemento
                                              WHERE ref_cod_escola = escola.cod_escola))) AS nm_escola,

       (SELECT COALESCE((SELECT COALESCE((SELECT logradouro.nome
         FROM public.logradouro,
              cadastro.juridica,
              cadastro.pessoa ps,
              cadastro.endereco_pessoa
        WHERE juridica.idpes = ps.idpes AND
              ps.idpes = endereco_pessoa.idpes AND
              endereco_pessoa.idlog = logradouro.idlog AND
              juridica.idpes = escola.ref_idpes),(SELECT endereco_externo.logradouro
                                                    FROM cadastro.endereco_externo
                                                   WHERE endereco_externo.idpes = escola.ref_idpes))),(SELECT logradouro FROM pmieducar.escola_complemento where ref_cod_escola = escola.cod_escola))) AS logradouro,

      (SELECT COALESCE((SELECT COALESCE((SELECT bairro.nome
         FROM public.municipio,
              cadastro.endereco_pessoa,
              cadastro.juridica,
              public.bairro
        WHERE endereco_pessoa.idbai = bairro.idbai AND
              bairro.idmun = municipio.idmun AND
              juridica.idpes = endereco_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes),(SELECT endereco_externo.bairro FROM cadastro.endereco_externo WHERE endereco_externo.idpes = escola.ref_idpes))),(SELECT bairro FROM pmieducar.escola_complemento where ref_cod_escola = escola.cod_escola))) AS bairro,

      (SELECT COALESCE((SELECT COALESCE ((SELECT municipio.nome
         FROM public.municipio,
              cadastro.endereco_pessoa,
              cadastro.juridica,
              public.bairro
        WHERE endereco_pessoa.idbai = bairro.idbai AND
              bairro.idmun = municipio.idmun AND
              juridica.idpes = endereco_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes), (SELECT endereco_externo.cidade FROM cadastro.endereco_externo WHERE endereco_externo.idpes = escola.ref_idpes))),(SELECT municipio FROM pmieducar.escola_complemento where ref_cod_escola = escola.cod_escola))) AS municipio,

      (SELECT COALESCE((SELECT COALESCE((SELECT endereco_pessoa.numero
         FROM cadastro.endereco_pessoa,
              cadastro.juridica
        WHERE juridica.idpes = endereco_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes),(SELECT endereco_externo.numero FROM cadastro.endereco_externo WHERE endereco_externo.idpes = escola.ref_idpes))),(SELECT numero FROM pmieducar.escola_complemento where ref_cod_escola = escola.cod_escola))) AS numero,


      (SELECT COALESCE((SELECT COALESCE((SELECT municipio.sigla_uf
         FROM public.municipio,
              cadastro.endereco_pessoa,
              cadastro.juridica,
              public.bairro
        WHERE endereco_pessoa.idbai = bairro.idbai AND
              bairro.idmun = municipio.idmun AND
              juridica.idpes = endereco_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes),(SELECT endereco_externo.sigla_uf FROM cadastro.endereco_externo WHERE endereco_externo.idpes = escola.ref_idpes))),(select inst.ref_sigla_uf from pmieducar.instituicao inst where inst.cod_instituicao = instituicao.cod_instituicao))) AS uf_municipio,

     (SELECT COALESCE((SELECT min(to_char(fone_pessoa.ddd,'99'))
         FROM cadastro.fone_pessoa,
              cadastro.juridica
        WHERE juridica.idpes = fone_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes),COALESCE((SELECT min(to_char(ddd_telefone,'99')) FROM pmieducar.escola_complemento where ref_cod_escola = escola.cod_escola),''))) AS fone_ddd,

     (SELECT COALESCE((SELECT COALESCE((SELECT to_char(endereco_pessoa.cep, '99999-999')
         FROM cadastro.endereco_pessoa,
              cadastro.juridica
        WHERE juridica.idpes = endereco_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes),(SELECT to_char(endereco_externo.cep,'99999-999') FROM cadastro.endereco_externo WHERE endereco_externo.idpes = escola.ref_idpes))),(SELECT to_char(escola_complemento.cep,'99999-999') FROM pmieducar.escola_complemento where escola_complemento.ref_cod_escola = escola.cod_escola))) AS cep,


     (SELECT COALESCE((SELECT min(to_char(fone_pessoa.fone, '9999-9999'))
         FROM cadastro.fone_pessoa,
              cadastro.juridica
        WHERE juridica.idpes = fone_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes),COALESCE((SELECT min(to_char(telefone, '9999-9999')) FROM pmieducar.escola_complemento where escola_complemento.ref_cod_escola = escola.cod_escola),''))) AS fone,

   (SELECT COALESCE((SELECT ps.email
         FROM cadastro.pessoa ps,
              cadastro.juridica
        WHERE juridica.idpes = ps.idpes AND
              juridica.idpes = escola.ref_idpes),(SELECT email FROM pmieducar.escola_complemento where ref_cod_escola = escola.cod_escola))) AS email,

   (select acervo_autor.nm_autor
      from pmieducar.acervo_autor,
           pmieducar.acervo_acervo_autor
     where acervo_acervo_autor.ref_cod_acervo_autor = acervo_autor.cod_acervo_autor AND
           acervo_acervo_autor.ref_cod_acervo = acervo.cod_acervo AND
           acervo_acervo_autor.principal = 1) as autor,

   (SELECT CAST(exemplar_emprestimo.data_retirada as DATE) + (SELECT CAST(dias_emprestimo as integer)
      FROM pmieducar.cliente_tipo_exemplar_tipo,
           pmieducar.cliente_tipo,
           pmieducar.cliente,
           pmieducar.cliente_tipo_cliente,
           pmieducar.exemplar_tipo
     WHERE cliente_tipo_exemplar_tipo.ref_cod_cliente_tipo = cliente_tipo.cod_cliente_tipo AND
           cliente_tipo.ref_cod_biblioteca = biblioteca.cod_biblioteca AND
           cliente.cod_cliente = cliente_tipo_cliente.ref_cod_cliente AND
           cliente_tipo_cliente.ref_cod_cliente = exemplar_emprestimo.ref_cod_cliente AND
           cliente_tipo_cliente.ref_cod_cliente_tipo = cliente_tipo.cod_cliente_tipo AND
           cliente_tipo_exemplar_tipo.ref_cod_exemplar_tipo = exemplar_tipo.cod_exemplar_tipo AND
           exemplar_tipo.cod_exemplar_tipo = acervo.ref_cod_exemplar_tipo)) as data_entrega

  FROM pmieducar.acervo,
       pmieducar.biblioteca,
       pmieducar.instituicao,
       pmieducar.escola,
       pmieducar.exemplar,
       pmieducar.exemplar_emprestimo

 WHERE instituicao.cod_instituicao = $P{instituicao} AND
       instituicao.cod_instituicao = biblioteca.ref_cod_instituicao AND
       acervo.ref_cod_biblioteca = biblioteca.cod_biblioteca AND
       acervo.cod_acervo = exemplar.ref_cod_acervo AND
       exemplar.ativo = 1 AND
       acervo.ativo = 1 AND
       exemplar_emprestimo.ref_cod_exemplar = exemplar.cod_exemplar AND
       escola.cod_escola = $P{escola} AND
       biblioteca.ref_cod_escola = escola.cod_escola AND
       exemplar.ref_cod_acervo = acervo.cod_acervo AND
       exemplar.cod_exemplar = exemplar_emprestimo.ref_cod_exemplar AND
       (to_char(exemplar_emprestimo.data_retirada,'dd/mm/yyyy') >= $P{dt_inicial}) and
       (to_char(exemplar_emprestimo.data_retirada,'dd/mm/yyyy') <= $P{dt_final}) and
       exemplar_emprestimo.ref_cod_cliente = $P{cliente} AND
       exemplar_emprestimo.ref_cod_exemplar = exemplar_emprestimo.ref_cod_exemplar and
       exemplar_emprestimo.data_devolucao is NULL]]>
	</queryString>
	<field name="nm_instituicao" class="java.lang.String"/>
	<field name="cod_emprestimo" class="java.lang.Integer"/>
	<field name="ref_cod_cliente" class="java.lang.Integer"/>
	<field name="ref_cod_exemplar" class="java.lang.Integer"/>
	<field name="titulo" class="java.lang.String"/>
	<field name="cliente" class="java.lang.String"/>
	<field name="cpf_cliente" class="java.math.BigDecimal"/>
	<field name="dt_retirada" class="java.lang.String"/>
	<field name="dt_devolucao" class="java.lang.String"/>
	<field name="valor_multa" class="java.lang.Double"/>
	<field name="nm_biblioteca" class="java.lang.String"/>
	<field name="nm_escola" class="java.lang.String"/>
	<field name="logradouro" class="java.lang.String"/>
	<field name="bairro" class="java.lang.String"/>
	<field name="municipio" class="java.lang.String"/>
	<field name="numero" class="java.math.BigDecimal"/>
	<field name="uf_municipio" class="java.lang.String"/>
	<field name="fone_ddd" class="java.lang.String"/>
	<field name="cep" class="java.lang.String"/>
	<field name="fone" class="java.lang.String"/>
	<field name="email" class="java.lang.String"/>
	<field name="autor" class="java.lang.String"/>
	<field name="data_entrega" class="java.sql.Date"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="81" splitType="Stretch">
			<textField>
				<reportElement uuid="4a338885-19c8-459b-ae27-ea1387a22aad" x="11" y="57" width="355" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA["Biblioteca: "+$F{nm_biblioteca}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement uuid="6b0e8b92-7aa9-4346-aa7f-fa071ba4ee97" x="11" y="42" width="38" height="13"/>
				<textElement markup="none">
					<font fontName="DejaVu Sans" size="8" isBold="false"/>
				</textElement>
				<text><![CDATA[Telefone: ]]></text>
			</staticText>
			<textField>
				<reportElement uuid="9144263a-35de-4cfc-b311-dddeb06b74e0" x="11" y="28" width="307" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{nm_instituicao}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="70fef7d1-5699-42e4-9a83-ee01e42e5c91" x="49" y="42" width="19" height="13"/>
				<textElement textAlignment="Center">
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{fone_ddd}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="925d9789-b226-40b9-a29e-b729cd313894" x="68" y="42" width="82" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{fone}]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band height="17" splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="17" splitType="Stretch">
			<staticText>
				<reportElement uuid="27f79437-980d-40fc-a4ac-4491ac49f088" x="25" y="1" width="35" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<text><![CDATA[Código]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="1d47d5fd-5e99-4f9b-8a83-186d1f5e3fa5" x="65" y="1" width="30" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<text><![CDATA[Cliente]]></text>
			</staticText>
			<line>
				<reportElement uuid="3cbb9048-3a88-4bc8-80cc-bf453f7ad590" x="7" y="15" width="544" height="1"/>
				<graphicElement>
					<pen lineWidth="0.25"/>
				</graphicElement>
			</line>
			<staticText>
				<reportElement uuid="af10d0cf-b5d9-4350-84db-0847d0ce7afa" x="255" y="1" width="30" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<text><![CDATA[Tombo]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="95fdee1c-e2d9-4422-a3d4-893fccc1aea2" x="291" y="1" width="40" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<text><![CDATA[Exemplar]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="612c2cf4-b2df-43e6-bd3d-14e62cadd826" x="186" y="-94" width="203" height="14"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Comprovante de Empréstimo]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="8e6bf76f-f07a-4ae3-bbee-37a7275b32b5" x="11" y="-15" width="294" height="14"/>
				<textElement markup="none">
					<font fontName="DejaVu Sans" size="8" isBold="false"/>
				</textElement>
				<text><![CDATA[Declaro para os devidos fins que recebi os itens abaixo descriminados:]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="17" splitType="Stretch">
			<textField isBlankWhenNull="true">
				<reportElement uuid="085bb175-967d-4eb7-890d-27f78ea753c5" isPrintRepeatedValues="false" x="25" y="2" width="35" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{ref_cod_cliente}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="f0b75417-3a16-4a09-a14b-664814d87246" isPrintRepeatedValues="false" x="65" y="2" width="187" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cliente}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="915c7a01-380e-4521-96ee-6eda59985c42" x="255" y="2" width="30" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{ref_cod_exemplar}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="306b6000-bd8e-4f7f-aa9e-e9ddd979e4ab" x="291" y="2" width="249" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{titulo}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="3" splitType="Stretch"/>
	</pageFooter>
	<lastPageFooter>
		<band height="631">
			<staticText>
				<reportElement uuid="5cfe14d0-ef78-4390-9653-bf552aef450f" positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="103" y="60" width="99" height="14" isPrintWhenDetailOverflows="true"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="false"/>
				</textElement>
				<text><![CDATA[Assinatura do Cliente]]></text>
			</staticText>
			<line>
				<reportElement uuid="e3d7795e-ea31-4ca6-bac8-5cc56bf5a3f2" positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="58" y="57" width="203" height="1" isPrintWhenDetailOverflows="true"/>
				<graphicElement>
					<pen lineWidth="0.25"/>
				</graphicElement>
			</line>
			<staticText>
				<reportElement uuid="10c279ef-fd02-472d-8902-702b4f4e5b21" positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="326" y="60" width="174" height="14" isPrintWhenDetailOverflows="true"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="false"/>
				</textElement>
				<text><![CDATA[Assinatura e Carimbo do Bibliotecário(a)]]></text>
			</staticText>
			<line>
				<reportElement uuid="e1ad65bb-bd60-41a2-b403-88fddc8eb47c" positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="308" y="57" width="203" height="1" isPrintWhenDetailOverflows="true"/>
				<graphicElement>
					<pen lineWidth="0.25"/>
				</graphicElement>
			</line>
			<staticText>
				<reportElement uuid="a4ec2352-fe3e-4d89-b103-921b7b9a863b" positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="11" y="3" width="99" height="14" isPrintWhenDetailOverflows="true"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="false"/>
				</textElement>
				<text><![CDATA[Data da retirada]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="ccb0bca1-85ee-4388-8651-8e3cb01c3b10" positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="412" y="3" width="99" height="14" isPrintWhenDetailOverflows="true"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="false"/>
				</textElement>
				<text><![CDATA[Data de devolução]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement uuid="dda79987-3973-4004-97f3-2de23cd6769c" positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="124" y="73" width="78" height="13" isPrintWhenDetailOverflows="true"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cpf_cliente}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement uuid="76d66279-82aa-420b-bbf6-5eb989a3fd2a" positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="103" y="73" width="21" height="13" isPrintWhenDetailOverflows="true"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="false"/>
				</textElement>
				<text><![CDATA[CPF:]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy">
				<reportElement uuid="34cec84d-d867-466d-8b70-11dac39ebaef" positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="412" y="18" width="70" height="13" isPrintWhenDetailOverflows="true"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{data_entrega}]]></textFieldExpression>
			</textField>
			<textField pattern="MM/dd/yyyy" isBlankWhenNull="true">
				<reportElement uuid="93d43452-330b-461d-adb9-c0b99be5649b" x="11" y="18" width="70" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{dt_retirada}]]></textFieldExpression>
			</textField>
		</band>
	</lastPageFooter>
	<summary>
		<band height="15" splitType="Stretch"/>
	</summary>
</jasperReport>
