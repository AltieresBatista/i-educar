<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="portabilis_registro_contra_capa_diario" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
	<property name="ireport.zoom" value="1.2100000000000006"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="527"/>
	<subDataset name="dataset1"/>
	<subDataset name="dataset2"/>
	<subDataset name="dataset3"/>
	<parameter name="ano" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new java.lang.Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="instituicao" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new java.lang.Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="escola" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new java.lang.Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="curso" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new java.lang.Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="serie" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new java.lang.Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="turma" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new java.lang.Integer(0)]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT public.fcn_upper(nm_instituicao) AS nome_instituicao,
       public.fcn_upper(nm_responsavel) AS nome_responsavel,
       instituicao.cidade AS cidade_instituicao,
       public.fcn_upper(ref_sigla_uf) AS uf_instituicao,
       escola.cod_escola AS cod_escola,
       escola_ano_letivo.ano,
       curso.nm_curso,
       serie.nm_serie,
       turma.nm_turma,
       to_char(CURRENT_DATE,'dd/mm/yyyy') AS data_atual,
       to_char(current_timestamp, 'HH24:MI:SS') AS hora_atual,
		(SELECT CASE WHEN date_part('hour',turma.hora_inicial) = 7 or date_part('hour',turma.hora_inicial) = 8 THEN 'Matutino'
                     WHEN date_part('hour',turma.hora_inicial) = 13 or date_part('hour',turma.hora_inicial) = 14 THEN 'Verpertino'
                     WHEN date_part('hour',turma.hora_inicial) = 18 or date_part('hour',turma.hora_inicial) = 19 THEN 'Noturno'
                END
           FROM pmieducar.turma tr
         WHERE  tr.ref_ref_cod_escola = escola_serie.ref_cod_escola and
               tr.ref_ref_cod_serie = escola_serie.ref_cod_serie and
               escola_serie.ref_cod_escola = escola.cod_escola and
		       tr.ativo = 1 AND
			   tr.hora_inicial IS NOT NULL AND
			   tr.cod_turma = turma.cod_turma) AS periodo,

		(SELECT CASE WHEN date_part('hour',turma.hora_inicial) = 7 or date_part('hour',turma.hora_inicial) = 8 THEN 1
                     WHEN date_part('hour',turma.hora_inicial) = 13 or date_part('hour',turma.hora_inicial) = 14 THEN 2
                     WHEN date_part('hour',turma.hora_inicial) = 18 or date_part('hour',turma.hora_inicial) = 19 THEN 2
                END
           FROM pmieducar.turma tr
         WHERE  tr.ref_ref_cod_escola = escola_serie.ref_cod_escola and
               tr.ref_ref_cod_serie = escola_serie.ref_cod_serie and
               escola_serie.ref_cod_escola = escola.cod_escola and
		       tr.ativo = 1 AND
			   tr.hora_inicial IS NOT NULL AND
			   tr.cod_turma = turma.cod_turma) AS periodo_aux,

       (SELECT public.fcn_upper(ps.nome)
          FROM cadastro.pessoa ps,
               cadastro.juridica
         WHERE escola.ref_idpes = juridica.idpes AND
               juridica.idpes = ps.idpes) AS nm_escola,

      (SELECT public.fcn_upper(substring(logradouro.idtlog from 1 for 1)) ||
              lower(substring(logradouro.idtlog, 2))
         FROM public.logradouro,
              cadastro.juridica,
              cadastro.pessoa ps,
              cadastro.endereco_pessoa
        WHERE juridica.idpes = ps.idpes AND
              ps.idpes = endereco_pessoa.idpes AND
              endereco_pessoa.idlog = logradouro.idlog AND
              juridica.idpes = escola.ref_idpes) AS tipo_logradouro,

      (SELECT COALESCE((SELECT logradouro.nome
         FROM public.logradouro,
              cadastro.juridica,
              cadastro.pessoa ps,
              cadastro.endereco_pessoa
        WHERE juridica.idpes = ps.idpes AND
              ps.idpes = endereco_pessoa.idpes AND
              endereco_pessoa.idlog = logradouro.idlog AND
              juridica.idpes = escola.ref_idpes),(SELECT endereco_externo.logradouro FROM cadastro.endereco_externo WHERE endereco_externo.idpes = escola.ref_idpes))) AS logradouro,


      (SELECT COALESCE ((SELECT municipio.nome
         FROM public.municipio,
              cadastro.endereco_pessoa,
              cadastro.juridica,
              public.bairro
        WHERE endereco_pessoa.idbai = bairro.idbai AND
              bairro.idmun = municipio.idmun AND
              juridica.idpes = endereco_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes), (SELECT endereco_externo.cidade FROM cadastro.endereco_externo WHERE endereco_externo.idpes = escola.ref_idpes))) AS municipio,


      (SELECT COALESCE((SELECT bairro.nome
         FROM public.municipio,
              cadastro.endereco_pessoa,
              cadastro.juridica,
              public.bairro
        WHERE endereco_pessoa.idbai = bairro.idbai AND
              bairro.idmun = municipio.idmun AND
              juridica.idpes = endereco_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes),(SELECT endereco_externo.bairro FROM cadastro.endereco_externo WHERE endereco_externo.idpes = escola.ref_idpes))) AS bairro,


      (SELECT COALESCE((SELECT municipio.sigla_uf
         FROM public.municipio,
              cadastro.endereco_pessoa,
              cadastro.juridica,
              public.bairro
        WHERE endereco_pessoa.idbai = bairro.idbai AND
              bairro.idmun = municipio.idmun AND
              juridica.idpes = endereco_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes),(SELECT endereco_externo.sigla_uf FROM cadastro.endereco_externo WHERE endereco_externo.idpes = escola.ref_idpes))) AS uf_municipio,

      (SELECT COALESCE((SELECT endereco_pessoa.numero
         FROM cadastro.endereco_pessoa,
              cadastro.juridica
        WHERE juridica.idpes = endereco_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes),(SELECT endereco_externo.numero FROM cadastro.endereco_externo WHERE endereco_externo.idpes = escola.ref_idpes))) AS numero,


     (SELECT COALESCE((SELECT to_char(endereco_pessoa.cep, '99999-999')
         FROM cadastro.endereco_pessoa,
              cadastro.juridica
        WHERE juridica.idpes = endereco_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes),(SELECT to_char(endereco_externo.cep,'99999-999') FROM cadastro.endereco_externo WHERE endereco_externo.idpes = escola.ref_idpes))) AS cep,


     (SELECT min(fone_pessoa.ddd)
         FROM cadastro.fone_pessoa,
              cadastro.juridica
        WHERE juridica.idpes = fone_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes) AS fone_ddd,

     (SELECT min(to_char(fone_pessoa.fone, '9999-9999'))
         FROM cadastro.fone_pessoa,
              cadastro.juridica
        WHERE juridica.idpes = fone_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes) AS fone,

     (SELECT ps.email
         FROM cadastro.pessoa ps,
              cadastro.juridica
        WHERE juridica.idpes = ps.idpes AND
              juridica.idpes = escola.ref_idpes) AS email,

       to_char(current_date,'dd/mm/yyyy') AS data_atual,
       to_char(current_timestamp, 'HH24:MI:SS') AS hora_atual,
       matricula.cod_matricula,

     (SELECT pessoa.nome
        FROM cadastro.pessoa,
             cadastro.fisica
       WHERE pessoa.idpes = fisica.idpes AND
             fisica.idpes = aluno.ref_idpes) AS nome_aluno,

     (SELECT cod_aluno_inep
        FROM modules.educacenso_cod_aluno
       WHERE educacenso_cod_aluno.cod_aluno = aluno.cod_aluno) as cod_aluno_inep

  FROM pmieducar.instituicao,
       pmieducar.escola,
       pmieducar.escola_ano_letivo,
       pmieducar.escola_curso,
       pmieducar.escola_serie,
       pmieducar.curso,
       pmieducar.serie,
       pmieducar.turma,
       pmieducar.matricula,
       pmieducar.matricula_turma,
       pmieducar.aluno

 WHERE escola_ano_letivo.ano = $P{ano} AND
       instituicao.cod_instituicao = $P{instituicao} AND
       escola.cod_escola = $P{escola} AND
       curso.cod_curso = $P{curso} AND
       serie.cod_serie = $P{serie} AND
       turma.cod_turma = $P{turma} AND
       escola_serie.ref_cod_escola = escola.cod_escola AND
       escola_serie.ref_cod_serie = serie.cod_serie AND
       escola_curso.ref_cod_curso = curso.cod_curso AND
       escola_curso.ref_cod_escola = escola.cod_escola AND
       escola.ref_cod_instituicao = instituicao.cod_instituicao AND
       turma.ref_ref_cod_escola = escola_serie.ref_cod_escola and
       turma.ref_ref_cod_serie = escola_serie.ref_cod_serie AND
       turma.ref_cod_curso = curso.cod_curso AND
       turma.ref_cod_instituicao = instituicao.cod_instituicao AND
       matricula.cod_matricula = matricula_turma.ref_cod_matricula AND
       matricula_turma.ref_cod_turma = turma.cod_turma AND
       matricula.ref_ref_cod_serie = serie.cod_serie AND
       matricula.ref_ref_cod_escola = escola.cod_escola AND
       matricula.ref_cod_aluno = aluno.cod_aluno AND
       escola_ano_letivo.ref_cod_escola = escola.cod_escola AND
       escola.ativo = 1 AND
       instituicao.ativo = 1 AND
       matricula.ultima_matricula = 1 AND
       matricula.ano = $P{ano}

ORDER BY nome_aluno ASC]]>
	</queryString>
	<field name="nome_instituicao" class="java.lang.String"/>
	<field name="nome_responsavel" class="java.lang.String"/>
	<field name="cidade_instituicao" class="java.lang.String"/>
	<field name="uf_instituicao" class="java.lang.String"/>
	<field name="cod_escola" class="java.lang.Integer"/>
	<field name="ano" class="java.lang.Integer"/>
	<field name="nm_curso" class="java.lang.String"/>
	<field name="nm_serie" class="java.lang.String"/>
	<field name="nm_turma" class="java.lang.String"/>
	<field name="data_atual" class="java.lang.String"/>
	<field name="hora_atual" class="java.lang.String"/>
	<field name="periodo" class="java.lang.String"/>
	<field name="periodo_aux" class="java.lang.Integer"/>
	<field name="nm_escola" class="java.lang.String"/>
	<field name="tipo_logradouro" class="java.lang.String"/>
	<field name="logradouro" class="java.lang.String"/>
	<field name="municipio" class="java.lang.String"/>
	<field name="bairro" class="java.lang.String"/>
	<field name="uf_municipio" class="java.lang.String"/>
	<field name="numero" class="java.math.BigDecimal"/>
	<field name="cep" class="java.lang.String"/>
	<field name="fone_ddd" class="java.math.BigDecimal"/>
	<field name="fone" class="java.lang.String"/>
	<field name="email" class="java.lang.String"/>
	<field name="cod_matricula" class="java.lang.Integer"/>
	<field name="nome_aluno" class="java.lang.String"/>
	<field name="cod_aluno_inep" class="java.lang.Long"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band splitType="Stretch"/>
	</title>
	<pageHeader>
		<band height="769" splitType="Stretch">
			<staticText>
				<reportElement x="16" y="661" width="244" height="13"/>
				<textElement>
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[DATA, ASSINATURA E OBSERVAÇÕES DO PROFESSOR]]></text>
			</staticText>
			<line>
				<reportElement x="11" y="763" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="9" y="11" width="537" height="1"/>
			</line>
			<line>
				<reportElement x="9" y="12" width="2" height="752"/>
			</line>
			<line>
				<reportElement x="545" y="12" width="2" height="751"/>
			</line>
			<line>
				<reportElement x="10" y="605" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="622" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="639" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="41" width="535" height="1"/>
			</line>
			<staticText>
				<reportElement x="23" y="21" width="40" height="13"/>
				<textElement>
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[DATA]]></text>
			</staticText>
			<line>
				<reportElement x="68" y="12" width="2" height="645"/>
			</line>
			<staticText>
				<reportElement x="246" y="21" width="150" height="13"/>
				<textElement>
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[CONTEÚDO E ATIVIDADES]]></text>
			</staticText>
			<line>
				<reportElement x="10" y="57" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="73" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="91" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="109" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="125" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="143" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="159" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="176" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="192" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="210" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="228" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="244" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="262" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="278" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="295" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="311" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="329" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="345" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="363" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="381" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="397" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="415" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="433" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="449" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="467" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="483" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="501" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="519" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="535" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="553" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="571" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="587" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="10" y="657" width="535" height="1"/>
			</line>
			<line>
				<reportElement x="262" y="658" width="1" height="105"/>
			</line>
			<staticText>
				<reportElement x="267" y="661" width="278" height="13"/>
				<textElement>
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[DATA, ASSINATURA E OBSERVAÇÕES DO DIRETOR/SECRETÁRIO]]></text>
			</staticText>
		</band>
	</pageHeader>
	<columnHeader>
		<band splitType="Stretch"/>
	</columnHeader>
	<detail>
		<band height="5" splitType="Stretch"/>
	</detail>
	<columnFooter>
		<band height="5" splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="5" splitType="Stretch"/>
	</pageFooter>
	<summary>
		<band height="5" splitType="Stretch"/>
	</summary>
</jasperReport>
