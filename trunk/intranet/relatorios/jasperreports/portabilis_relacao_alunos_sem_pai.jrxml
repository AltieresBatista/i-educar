<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="portabilis_relacao_alunos_sem_pai" language="groovy" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
	<property name="ireport.zoom" value="0.9090909090909095"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="ano" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new java.lang.Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="instituicao" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new java.lang.Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="escola" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new java.lang.Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="logo" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT fcn_upper(pessoa.nome) as nome_aluno,
       matricula.cod_matricula,
       (SELECT municipio.nome || ' - ' || municipio.sigla_uf
          FROM public.municipio
         WHERE municipio.idmun = fisica.idmun_nascimento) AS municipio_nascimento,
       (SELECT pessoa.nome FROM cadastro.pessoa WHERE pessoa.idpes = fisica.idpes_responsavel) AS responsavel,

      (SELECT public.fcn_upper(instituicao.nm_responsavel)
         FROM pmieducar.instituicao
        WHERE instituicao.cod_instituicao = $P{instituicao}) AS nome_responsavel,

      (SELECT COALESCE((SELECT public.fcn_upper(ps.nome)
          FROM cadastro.pessoa ps,
               cadastro.juridica,
               pmieducar.escola
         WHERE escola.ref_idpes = juridica.idpes AND
               juridica.idpes = ps.idpes AND
               escola.cod_escola = $P{escola}),(SELECT nm_escola FROM pmieducar.escola_complemento where ref_cod_escola = $P{escola}))) AS nm_escola,


      (SELECT public.fcn_upper(instituicao.nm_instituicao)
         FROM pmieducar.instituicao
        WHERE instituicao.cod_instituicao = $P{instituicao}) AS nome_instituicao,

      (SELECT COALESCE((SELECT COALESCE((SELECT logradouro.nome
         FROM public.logradouro,
              cadastro.juridica,
              cadastro.pessoa ps,
              cadastro.endereco_pessoa,
              pmieducar.escola
        WHERE juridica.idpes = ps.idpes AND
              ps.idpes = endereco_pessoa.idpes AND
              endereco_pessoa.idlog = logradouro.idlog AND
              juridica.idpes = escola.ref_idpes AND
              escola.cod_escola = $P{escola}),(SELECT endereco_externo.logradouro FROM cadastro.endereco_externo, pmieducar.escola WHERE endereco_externo.idpes = escola.ref_idpes AND escola.cod_escola = $P{escola}))),(SELECT logradouro FROM pmieducar.escola_complemento where ref_cod_escola = $P{escola}))) AS logradouro,

      (SELECT COALESCE((SELECT COALESCE((SELECT municipio.nome
         FROM public.municipio,
              cadastro.endereco_pessoa,
              cadastro.juridica,
              public.bairro,
              pmieducar.escola
        WHERE endereco_pessoa.idbai = bairro.idbai AND
              bairro.idmun = municipio.idmun AND
              juridica.idpes = endereco_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes AND
              escola.cod_escola = $P{escola}),(SELECT endereco_externo.cidade FROM cadastro.endereco_externo, pmieducar.escola WHERE endereco_externo.idpes = escola.ref_idpes AND escola.cod_escola = $P{escola}))),(SELECT municipio FROM pmieducar.escola_complemento where ref_cod_escola = $P{escola}))) AS municipio,

      (SELECT COALESCE((SELECT COALESCE((SELECT bairro.nome
         FROM public.municipio,
              cadastro.endereco_pessoa,
              cadastro.juridica,
              public.bairro,
              pmieducar.escola
        WHERE endereco_pessoa.idbai = bairro.idbai AND
              bairro.idmun = municipio.idmun AND
              juridica.idpes = endereco_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes AND
              escola.cod_escola = $P{escola}),(SELECT endereco_externo.bairro FROM cadastro.endereco_externo, pmieducar.escola WHERE endereco_externo.idpes = escola.ref_idpes AND escola.cod_escola = $P{escola}))),(SELECT bairro FROM pmieducar.escola_complemento where ref_cod_escola = $P{escola}))) AS bairro,

      (SELECT COALESCE((SELECT COALESCE((SELECT municipio.sigla_uf
         FROM public.municipio,
              cadastro.endereco_pessoa,
              cadastro.juridica,
              public.bairro,
              pmieducar.escola
        WHERE endereco_pessoa.idbai = bairro.idbai AND
              bairro.idmun = municipio.idmun AND
              juridica.idpes = endereco_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes AND
              escola.cod_escola = $P{escola}),(SELECT endereco_externo.sigla_uf FROM cadastro.endereco_externo, pmieducar.escola WHERE endereco_externo.idpes = escola.ref_idpes AND escola.cod_escola = $P{escola}))),(select inst.ref_sigla_uf from pmieducar.instituicao inst where inst.cod_instituicao = 1))) AS uf_municipio,

      (SELECT COALESCE((SELECT COALESCE((SELECT endereco_pessoa.numero
         FROM cadastro.endereco_pessoa,
              cadastro.juridica,
              pmieducar.escola
        WHERE juridica.idpes = endereco_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes AND
              escola.cod_escola = $P{escola}),(SELECT endereco_externo.numero FROM cadastro.endereco_externo, pmieducar.escola WHERE endereco_externo.idpes = escola.ref_idpes AND escola.cod_escola = $P{escola}))),(SELECT numero FROM pmieducar.escola_complemento where ref_cod_escola = $P{escola}))) AS numero,

     (SELECT COALESCE((SELECT COALESCE((SELECT to_char(endereco_pessoa.cep, '99999-999')
         FROM cadastro.endereco_pessoa,
              cadastro.juridica,
              pmieducar.escola
        WHERE juridica.idpes = endereco_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes AND
              escola.cod_escola = $P{escola}),(SELECT to_char(endereco_externo.cep,'99999-999') FROM cadastro.endereco_externo, pmieducar.escola WHERE endereco_externo.idpes = escola.ref_idpes AND escola.cod_escola = $P{escola}))),(SELECT to_char(escola_complemento.cep,'99999-999') FROM pmieducar.escola_complemento where escola_complemento.ref_cod_escola = $P{escola}))) AS cep,

     (SELECT COALESCE((SELECT min(fone_pessoa.ddd)
         FROM cadastro.fone_pessoa,
              cadastro.juridica,
              pmieducar.escola
        WHERE juridica.idpes = fone_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes AND
              escola.cod_escola = $P{escola}),(SELECT min(ddd_telefone) FROM pmieducar.escola_complemento where ref_cod_escola = $P{escola}))) AS fone_ddd,


     (SELECT COALESCE((SELECT min(to_char(fone_pessoa.fone, '9999-9999'))
         FROM cadastro.fone_pessoa,
              cadastro.juridica,
              pmieducar.escola
        WHERE juridica.idpes = fone_pessoa.idpes AND
              juridica.idpes = escola.ref_idpes AND
              escola.cod_escola = $P{escola}),(SELECT min(to_char(telefone, '9999-9999')) FROM pmieducar.escola_complemento where escola_complemento.ref_cod_escola = $P{escola}))) AS fone,

     (SELECT COALESCE((SELECT ps.email
         FROM cadastro.pessoa ps,
              cadastro.juridica,
              pmieducar.escola
        WHERE juridica.idpes = ps.idpes AND
              juridica.idpes = escola.ref_idpes AND
              escola.cod_escola = $P{escola}),(SELECT email FROM pmieducar.escola_complemento where ref_cod_escola = $P{escola}))) AS email,
      (SELECT COALESCE((SELECT COALESCE((SELECT logradouro.nome
         FROM public.logradouro,
              cadastro.endereco_pessoa
        WHERE pessoa.idpes = endereco_pessoa.idpes AND
              endereco_pessoa.idlog = logradouro.idlog),(SELECT endereco_externo.logradouro FROM cadastro.endereco_externo WHERE endereco_externo.idpes = pessoa.idpes))))) AS logradouro_aluno,


      (SELECT COALESCE((SELECT COALESCE((SELECT municipio.nome || ' - ' || municipio.sigla_uf
         FROM public.municipio,
              cadastro.endereco_pessoa,
              public.logradouro
        WHERE pessoa.idpes = endereco_pessoa.idpes AND
              endereco_pessoa.idlog = logradouro.idlog AND
              logradouro.idmun = municipio.idmun),(SELECT endereco_externo.cidade FROM cadastro.endereco_externo WHERE endereco_externo.idpes = pessoa.idpes))))) AS municipio_aluno,

      (SELECT COALESCE((SELECT COALESCE((SELECT bairro.nome
         FROM public.municipio,
              cadastro.endereco_pessoa,
              public.bairro
        WHERE endereco_pessoa.idbai = bairro.idbai AND
              bairro.idmun = municipio.idmun AND
              pessoa.idpes = endereco_pessoa.idpes),(SELECT endereco_externo.bairro FROM cadastro.endereco_externo WHERE endereco_externo.idpes = pessoa.idpes))))) AS bairro_aluno,



      (SELECT COALESCE((SELECT COALESCE((SELECT endereco_pessoa.numero
         FROM cadastro.endereco_pessoa
        WHERE pessoa.idpes = endereco_pessoa.idpes),(SELECT endereco_externo.numero FROM cadastro.endereco_externo WHERE endereco_externo.idpes = pessoa.idpes))))) AS numero_aluno,

     (SELECT COALESCE((SELECT COALESCE((SELECT to_char(endereco_pessoa.cep, '99999-999')
         FROM cadastro.endereco_pessoa
        WHERE pessoa.idpes = endereco_pessoa.idpes),(SELECT to_char(endereco_externo.cep,'99999-999') FROM cadastro.endereco_externo WHERE endereco_externo.idpes = pessoa.idpes))))) AS cep_aluno,

     (SELECT COALESCE((SELECT min(fone_pessoa.ddd)
         FROM cadastro.fone_pessoa
        WHERE pessoa.idpes = fone_pessoa.idpes))) AS fone_ddd_aluno,

    (SELECT COALESCE((SELECT min(to_char(fone_pessoa.fone, '9999-9999'))
         FROM cadastro.fone_pessoa
        WHERE pessoa.idpes = fone_pessoa.idpes))) AS fone_aluno,
    COALESCE(aluno.nm_mae, fisica.nome_mae) as nome_ame

FROM pmieducar.aluno,
     pmieducar.matricula,
     cadastro.fisica,
     cadastro.pessoa

WHERE matricula.ref_cod_aluno = aluno.cod_aluno AND
      matricula.ref_ref_cod_escola = $P{escola} AND
      matricula.ativo = 1 AND
      matricula.ano = $P{ano} AND
      aluno.ref_idpes = fisica.idpes AND
      ((trim(aluno.nm_pai) = '') or (aluno.nm_pai is null)) AND ((trim(fisica.nome_pai) = '') or (fisica.nome_pai is null)) AND
      matricula.aprovado = 3 AND
      pessoa.idpes = fisica.idpes

ORDER BY pessoa.nome]]>
	</queryString>
	<field name="nome_aluno" class="java.lang.String"/>
	<field name="cod_matricula" class="java.lang.Integer"/>
	<field name="municipio_nascimento" class="java.lang.String"/>
	<field name="responsavel" class="java.lang.String"/>
	<field name="nome_responsavel" class="java.lang.String"/>
	<field name="nm_escola" class="java.lang.String"/>
	<field name="nome_instituicao" class="java.lang.String"/>
	<field name="logradouro" class="java.lang.String"/>
	<field name="municipio" class="java.lang.String"/>
	<field name="bairro" class="java.lang.String"/>
	<field name="uf_municipio" class="java.lang.String"/>
	<field name="numero" class="java.math.BigDecimal"/>
	<field name="cep" class="java.lang.String"/>
	<field name="fone_ddd" class="java.math.BigDecimal"/>
	<field name="fone" class="java.lang.String"/>
	<field name="email" class="java.lang.String"/>
	<field name="logradouro_aluno" class="java.lang.String"/>
	<field name="municipio_aluno" class="java.lang.String"/>
	<field name="bairro_aluno" class="java.lang.String"/>
	<field name="numero_aluno" class="java.math.BigDecimal"/>
	<field name="cep_aluno" class="java.lang.String"/>
	<field name="fone_ddd_aluno" class="java.math.BigDecimal"/>
	<field name="fone_aluno" class="java.lang.String"/>
	<field name="nome_ame" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="120" splitType="Stretch">
			<textField>
				<reportElement isPrintRepeatedValues="false" x="86" y="5" width="306" height="13" isPrintWhenDetailOverflows="true"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{nome_instituicao}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement isPrintRepeatedValues="false" x="86" y="65" width="247" height="13" isPrintWhenDetailOverflows="true"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Fone/Fax: ("+$F{fone_ddd}+") "+$F{fone}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement isPrintRepeatedValues="false" x="496" y="53" width="77" height="13" isPrintWhenDetailOverflows="true"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["CEP: "+$F{cep}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement isPrintRepeatedValues="false" x="336" y="65" width="187" height="13" isPrintWhenDetailOverflows="true"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["E-mail: "+$F{email}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement isPrintRepeatedValues="false" x="86" y="53" width="247" height="13" isPrintWhenDetailOverflows="true"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Bairro: " +$F{bairro}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement isPrintRepeatedValues="false" x="86" y="41" width="306" height="13" isPrintWhenDetailOverflows="true"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Endereço: "+$F{logradouro}+", "+$F{numero}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement isPrintRepeatedValues="false" x="336" y="53" width="157" height="13" isPrintWhenDetailOverflows="true"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{municipio}+" - "+$F{uf_municipio}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement isPrintRepeatedValues="false" x="86" y="17" width="306" height="13" isPrintWhenDetailOverflows="true"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{nome_responsavel}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement isPrintRepeatedValues="false" x="86" y="29" width="306" height="13" isPrintWhenDetailOverflows="true"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{nm_escola}]]></textFieldExpression>
			</textField>
			<image>
				<reportElement x="15" y="5" width="57" height="46"/>
				<imageExpression><![CDATA[$P{logo}]]></imageExpression>
			</image>
			<staticText>
				<reportElement x="270" y="85" width="262" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="DejaVu Sans" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Relação de Alunos sem Pai]]></text>
			</staticText>
		</band>
	</title>
	<pageHeader>
		<band height="21" splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="4" splitType="Immediate">
			<staticText>
				<reportElement x="2" y="-19" width="45" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Matrícula]]></text>
			</staticText>
			<staticText>
				<reportElement x="48" y="-19" width="39" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Aluno]]></text>
			</staticText>
			<staticText>
				<reportElement x="194" y="-19" width="106" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Cidade nascimento]]></text>
			</staticText>
			<staticText>
				<reportElement x="493" y="-19" width="39" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Bairro]]></text>
			</staticText>
			<staticText>
				<reportElement x="302" y="-19" width="74" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Cidade residência]]></text>
			</staticText>
			<staticText>
				<reportElement x="386" y="-19" width="58" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Logradouro]]></text>
			</staticText>
			<staticText>
				<reportElement x="593" y="-19" width="76" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Nome da mãe]]></text>
			</staticText>
			<staticText>
				<reportElement x="723" y="-19" width="61" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Telefone]]></text>
			</staticText>
			<line>
				<reportElement x="2" y="-4" width="798" height="1"/>
			</line>
		</band>
	</columnHeader>
	<detail>
		<band height="19" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="194" y="2" width="106" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{municipio_nascimento}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="48" y="2" width="144" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{nome_aluno}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="493" y="2" width="100" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{bairro_aluno}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="302" y="2" width="83" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{municipio_aluno}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="386" y="2" width="105" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{logradouro_aluno}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="594" y="2" width="128" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{nome_ame}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="723" y="2" width="77" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA["("+$F{fone_ddd_aluno}+") "+$F{fone_aluno}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="2" y="2" width="39" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cod_matricula}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band height="3" splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="3" splitType="Stretch"/>
	</pageFooter>
	<summary>
		<band height="25" splitType="Stretch">
			<staticText>
				<reportElement x="3" y="7" width="73" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Total de alunos:]]></text>
			</staticText>
			<line>
				<reportElement x="2" y="3" width="798" height="1"/>
			</line>
			<textField>
				<reportElement x="77" y="7" width="23" height="13"/>
				<textElement>
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{REPORT_COUNT}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
